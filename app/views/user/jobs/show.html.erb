<div class="container">
  <header class="row">
    <div class="col s12 m12 l12 left-align">
      <%= link_to "Â« Back to #{@job.category.name}",
                  category_path(@job.category),
                  class: "back-to-category-link" %>
    </div>
  </header>

  <%= render partial: "user/jobs/job_details" %>

  <div class="row left-align">
    <div class="col s12 m12 l12">
      <% if logged_in? && @job.bids_include_user(current_user.id) && @job.bidding_open?  %>
        <%= render partial: "user/jobs/my_bid_accordion" %>
      <% elsif logged_in? && current_user_does_not_own_job(@job.id) && @job.bidding_open?   %>
        <%= render partial: "user/jobs/place_a_bid_accordion" %>
      <% elsif logged_out? && @job.bidding_open? %>
        <div class="log-in-to-bid">
          <%= link_to "Log In To Place A Bid", login_path %>
        </div>
      <% elsif !@job.bidding_open? %>
        <div class="bidding-closed">
          Bidding Is Closed For This Job
        </div>
      <% end %>
    </div>
  </div>

  <% if logged_in? && current_user_owns_current_job(@job.id) %>
    <%= render partial: "user/jobs/current_bids_table", locals: { bids: @job.bids } %>
  <% end %>

  <%= render partial: "user/jobs/lister_details" %>
</div>

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<script type="text/javascript">
  $( "#accordion" ).accordion({
    animate: 200,
    active: false,
    collapsible: true,
    heightStyle: "content",
    autoHeight: false
  });
</script>

<%= javascript_tag do %>
  var map;
  function initMap() {
    map = new google.maps.Map(document.getElementById('google-map'), {
      zoom: 13
    });

    var zipcode = <%= @job.zipcode %>;

    geocoder = new google.maps.Geocoder();
    geocoder.geocode( { 'address': 'zipcode' }, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
      } else {
        alert("Geocode was not successful for the following reason: " + status);
      }
    })
  }
<% end %>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm1nN_vOXj6XM6U8rRNaBDAcprgDB1pkM&callback=initMap"
async defer></script>
